import{r as m,j as e,k as W,l as A,e as P,f as J,i as Q,m as R,H as X}from"./app-Bi53cwRe.js";import{H as Y}from"./Header-uQBK6Lvz.js";import{c as Z,B as I}from"./use-theme-CGehCXYH.js";import{I as v}from"./input-P5n5ME8U.js";import{L as j}from"./label-COTh75sX.js";import{C as N,a as b,b as y,d as S,c as C}from"./card-CuJFQQ2i.js";import{r as ee}from"./index-DmWIRZv8.js";import{B as ae}from"./badge-De33JYzz.js";import{A as F,b as M}from"./alert-Cwqi5-B0.js";import{M as se,T as D}from"./MainLayout-jKifpoFS.js";import{S as _}from"./shield-Cjmh3r0z.js";import{S as re}from"./save-_R3qz_cD.js";/* empty css            */import"./user-DFNe86Sn.js";import"./index-PFpZpo28.js";function te(s,a=[]){let t=[];function i(r,o){const n=m.createContext(o);n.displayName=r+"Context";const d=t.length;t=[...t,o];const u=p=>{const{scope:g,children:w,...f}=p,l=g?.[s]?.[d]||n,h=m.useMemo(()=>f,Object.values(f));return e.jsx(l.Provider,{value:h,children:w})};u.displayName=r+"Provider";function x(p,g){const w=g?.[s]?.[d]||n,f=m.useContext(w);if(f)return f;if(o!==void 0)return o;throw new Error(`\`${p}\` must be used within \`${r}\``)}return[u,x]}const c=()=>{const r=t.map(o=>m.createContext(o));return function(n){const d=n?.[s]||r;return m.useMemo(()=>({[`__scope${s}`]:{...n,[s]:d}}),[n,d])}};return c.scopeName=s,[i,ne(c,...a)]}function ne(...s){const a=s[0];if(s.length===1)return a;const t=()=>{const i=s.map(c=>({useScope:c(),scopeName:c.scopeName}));return function(r){const o=i.reduce((n,{useScope:d,scopeName:u})=>{const p=d(r)[`__scope${u}`];return{...n,...p}},{});return m.useMemo(()=>({[`__scope${a.scopeName}`]:o}),[o])}};return t.scopeName=a.scopeName,t}var oe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],E=oe.reduce((s,a)=>{const t=Z(`Primitive.${a}`),i=m.forwardRef((c,r)=>{const{asChild:o,...n}=c,d=o?t:a;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(d,{...n,ref:r})});return i.displayName=`Primitive.${a}`,{...s,[a]:i}},{}),ie=ee();function de(){return ie.useSyncExternalStore(ce,()=>!0,()=>!1)}function ce(){return()=>{}}var L="Avatar",[le]=te(L),[me,k]=le(L),z=m.forwardRef((s,a)=>{const{__scopeAvatar:t,...i}=s,[c,r]=m.useState("idle");return e.jsx(me,{scope:t,imageLoadingStatus:c,onImageLoadingStatusChange:r,children:e.jsx(E.span,{...i,ref:a})})});z.displayName=L;var T="AvatarImage",H=m.forwardRef((s,a)=>{const{__scopeAvatar:t,src:i,onLoadingStatusChange:c=()=>{},...r}=s,o=k(T,t),n=ue(i,r),d=W(u=>{c(u),o.onImageLoadingStatusChange(u)});return A(()=>{n!=="idle"&&d(n)},[n,d]),n==="loaded"?e.jsx(E.img,{...r,ref:a,src:i}):null});H.displayName=T;var B="AvatarFallback",G=m.forwardRef((s,a)=>{const{__scopeAvatar:t,delayMs:i,...c}=s,r=k(B,t),[o,n]=m.useState(i===void 0);return m.useEffect(()=>{if(i!==void 0){const d=window.setTimeout(()=>n(!0),i);return()=>window.clearTimeout(d)}},[i]),o&&r.imageLoadingStatus!=="loaded"?e.jsx(E.span,{...c,ref:a}):null});G.displayName=B;function $(s,a){return s?a?(s.src!==a&&(s.src=a),s.complete&&s.naturalWidth>0?"loaded":"loading"):"error":"idle"}function ue(s,{referrerPolicy:a,crossOrigin:t}){const i=de(),c=m.useRef(null),r=i?(c.current||(c.current=new window.Image),c.current):null,[o,n]=m.useState(()=>$(r,s));return A(()=>{n($(r,s))},[r,s]),A(()=>{const d=p=>()=>{n(p)};if(!r)return;const u=d("loaded"),x=d("error");return r.addEventListener("load",u),r.addEventListener("error",x),a&&(r.referrerPolicy=a),typeof t=="string"&&(r.crossOrigin=t),()=>{r.removeEventListener("load",u),r.removeEventListener("error",x)}},[r,t,a]),o}var V=z,O=H,q=G;const K=m.forwardRef(({className:s,...a},t)=>e.jsx(V,{ref:t,className:P("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...a}));K.displayName=V.displayName;const pe=m.forwardRef(({className:s,...a},t)=>e.jsx(O,{ref:t,className:P("aspect-square h-full w-full",s),...a}));pe.displayName=O.displayName;const U=m.forwardRef(({className:s,...a},t)=>e.jsx(q,{ref:t,className:P("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...a}));U.displayName=q.displayName;function Ee(){const{toast:s}=J(),a=Q().props.auth.user,{data:t,setData:i,put:c,processing:r,errors:o}=R({name:a.name,email:a.email}),{data:n,setData:d,put:u,processing:x,errors:p,reset:g}=R({current_password:"",new_password:"",new_password_confirmation:""}),w=l=>{l.preventDefault(),c("/perfil",{preserveScroll:!0,onSuccess:()=>{s({title:"✓ Perfil actualizado",description:"Tus datos se han guardado correctamente."})},onError:h=>{s({variant:"destructive",title:"Error al actualizar perfil",description:h.email||h.name||"Ocurrió un error inesperado"})}})},f=l=>{if(l.preventDefault(),a.role!=="admin"){s({variant:"destructive",title:"Acceso denegado",description:"Los vendedores no pueden cambiar su contraseña."});return}if(n.new_password!==n.new_password_confirmation){s({variant:"destructive",title:"Error",description:"Las contraseñas no coinciden."});return}u("/perfil/password",{preserveScroll:!0,onSuccess:()=>{g(),s({title:"✓ Contraseña actualizada",description:"Tu contraseña se ha cambiado correctamente."})},onError:h=>{s({variant:"destructive",title:"Error al cambiar contraseña",description:h.current_password||h.new_password||"Ocurrió un error"})}})};return e.jsxs(se,{children:[e.jsx(X,{title:"Mi Perfil"}),e.jsxs("div",{className:"flex flex-col min-h-screen",children:[e.jsx(Y,{title:"Mi Perfil",subtitle:"Gestiona tu información personal"}),e.jsx("main",{className:"flex-1 p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto grid gap-6 md:grid-cols-3",children:[e.jsx("div",{className:"md:col-span-1 space-y-6",children:e.jsxs(N,{children:[e.jsxs(b,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(K,{className:"w-24 h-24",children:e.jsx(U,{className:"text-3xl bg-primary text-primary-foreground font-bold",children:a.name.charAt(0).toUpperCase()})})}),e.jsx(y,{children:a.name}),e.jsx(S,{className:"uppercase font-mono text-xs mt-1",children:a.role})]}),e.jsx(C,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-muted rounded-lg",children:[e.jsx(_,{className:"w-4 h-4 text-primary"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium",children:"Nivel de Acceso"}),e.jsx("p",{className:"text-muted-foreground capitalize",children:a.role==="admin"?"Administrador":"Vendedor"})]})]}),a.permissions&&a.permissions.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground",children:"Permisos activos:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:a.permissions.map(l=>e.jsx(ae,{variant:"secondary",className:"text-xs",children:l},l))})]})]})})]})}),e.jsxs("div",{className:"md:col-span-2 space-y-6",children:[e.jsxs(N,{children:[e.jsxs(b,{children:[e.jsx(y,{children:"Información de Cuenta"}),e.jsx(S,{children:a.role==="admin"?"Actualiza tus datos básicos":"Visualiza tu información de cuenta"})]}),e.jsx(C,{children:e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"nombre",children:"Nombre completo"}),e.jsx(v,{id:"nombre",value:t.name,onChange:l=>i("name",l.target.value),disabled:a.role!=="admin",className:a.role!=="admin"?"bg-muted text-muted-foreground":""}),o.name&&e.jsx("p",{className:"text-sm text-destructive",children:o.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"email",children:"Correo electrónico"}),e.jsx(v,{id:"email",type:"email",value:t.email,onChange:l=>i("email",l.target.value),disabled:a.role!=="admin",className:a.role!=="admin"?"bg-muted text-muted-foreground":""}),o.email&&e.jsx("p",{className:"text-sm text-destructive",children:o.email})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Rol del Sistema"}),e.jsx(v,{value:a.role==="admin"?"Administrador":"Vendedor",disabled:!0,className:"bg-muted text-muted-foreground font-semibold"}),e.jsx("p",{className:"text-[0.8rem] text-muted-foreground",children:"* Contacte a un administrador para cambiar su rol o permisos."})]}),a.role!=="admin"&&e.jsxs(F,{variant:"default",className:"border-blue-200 bg-blue-50",children:[e.jsx(D,{className:"h-4 w-4 text-blue-600"}),e.jsx(M,{className:"text-blue-800",children:"Como vendedor, tu información de perfil es de solo lectura. Contacta a un administrador si necesitas modificar tus datos."})]}),a.role==="admin"&&e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(I,{type:"submit",size:"lg",className:"gap-2",disabled:r,children:[e.jsx(re,{className:"w-4 h-4"}),r?"Guardando...":"Guardar cambios"]})})]})})]}),e.jsxs(N,{children:[e.jsxs(b,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"})," Seguridad"]}),e.jsx(S,{children:"Cambiar contraseña de acceso"})]}),e.jsx(C,{children:a.role!=="admin"?e.jsxs(F,{variant:"default",className:"border-amber-200 bg-amber-50",children:[e.jsx(D,{className:"h-4 w-4 text-amber-600"}),e.jsx(M,{className:"text-amber-800",children:"Como vendedor, no puedes cambiar tu contraseña. Por favor, contacta a un administrador si necesitas modificarla."})]}):e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"current-password",children:"Contraseña actual"}),e.jsx(v,{id:"current-password",type:"password",placeholder:"••••••••",value:n.current_password,onChange:l=>d("current_password",l.target.value)}),p.current_password&&e.jsx("p",{className:"text-sm text-destructive",children:p.current_password})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"new-password",children:"Nueva contraseña"}),e.jsx(v,{id:"new-password",type:"password",placeholder:"••••••••",value:n.new_password,onChange:l=>d("new_password",l.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"confirm-password",children:"Confirmar contraseña"}),e.jsx(v,{id:"confirm-password",type:"password",placeholder:"••••••••",value:n.new_password_confirmation,onChange:l=>d("new_password_confirmation",l.target.value)})]})]}),p.new_password&&e.jsx("p",{className:"text-sm text-destructive",children:p.new_password}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(I,{type:"submit",size:"lg",className:"gap-2",disabled:x,children:[e.jsx(_,{className:"w-4 h-4"}),x?"Actualizando...":"Cambiar contraseña"]})})]})})]})]})]})})]})]})}export{Ee as default};
