import{r as n}from"./app-Bi53cwRe.js";function E(l,C={}){const{url:i="ws://localhost:8001/ws/scanner",enabled:t=!0,reconnectInterval:f=3e3}=C,r=n.useRef(null),s=n.useRef(null),d=n.useRef(l),[g,o]=n.useState({isConnected:!1,isConnecting:!1,error:null});n.useEffect(()=>{d.current=l},[l]);const a=n.useCallback(()=>{if(t&&r.current?.readyState!==WebSocket.OPEN&&r.current?.readyState!==WebSocket.CONNECTING){o(e=>({...e,isConnecting:!0,error:null})),console.log("Conectando al scanner-app...");try{const e=new WebSocket(i);r.current=e,e.onopen=()=>{console.log("Conectado al scanner-app"),o({isConnected:!0,isConnecting:!1,error:null})},e.onmessage=p=>{try{const c=JSON.parse(p.data);c.type==="scan"&&c.barcode&&(console.log("Código recibido:",c.barcode),d.current(c.barcode))}catch{}},e.onclose=()=>{console.log("Desconectado del scanner-app"),o({isConnected:!1,isConnecting:!1,error:null}),r.current=null,t&&(s.current=setTimeout(()=>{a()},f))},e.onerror=p=>{console.log("Error de conexión con scanner-app (¿está corriendo?)"),o({isConnected:!1,isConnecting:!1,error:"No se pudo conectar al scanner-app"})};const b=setInterval(()=>{e.readyState===WebSocket.OPEN&&e.send("ping")},3e4);e.addEventListener("close",()=>{clearInterval(b)})}catch{o({isConnected:!1,isConnecting:!1,error:"Error al crear conexión WebSocket"})}}},[i,t,f]),u=n.useCallback(()=>{s.current&&(clearTimeout(s.current),s.current=null),r.current&&(r.current.close(),r.current=null)},[]);return n.useEffect(()=>(t?a():u(),()=>{u()}),[t,a,u]),{...g,reconnect:a}}export{E as u};
