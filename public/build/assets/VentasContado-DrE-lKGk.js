import{c as g,i as I,f as V,r as n,j as e,H as F,h as L,g as P}from"./app-Bi53cwRe.js";import{H as O}from"./Header-uQBK6Lvz.js";import{B as r}from"./use-theme-CGehCXYH.js";import{T as R,a as $,b as h,c as i,d as z,e as t}from"./table-Cy4khzhc.js";import{D as M,a as _,b as B,c as U}from"./dialog-DHyflgsl.js";import{T as q,A as G,a as J,b as K,c as Q,d as W,e as X}from"./alert-dialog-BmfwfED2.js";import{B as Y}from"./badge-De33JYzz.js";import{M as Z,P as f}from"./MainLayout-jKifpoFS.js";import{T as ee}from"./Ticket-B8XTleSG.js";import{l as se}from"./index-3JJJLzBS.js";/* empty css            */import"./user-DFNe86Sn.js";import"./index-PFpZpo28.js";const te=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],ae=g("funnel",te);const re=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],ie=g("loader-circle",re);function Ne({ventas:c}){const{businessSettings:N,printerSettings:b}=I().props,{toast:o}=V(),[l,v]=n.useState(null),[k,x]=n.useState(!1),[T,u]=n.useState(!1),[w,d]=n.useState(!1),[p,j]=n.useState(null),m=n.useRef(null),y=c.reduce((s,a)=>s+Number(a.monto),0),A=c.reduce((s,a)=>s+Number(a.utilidad),0),C=async s=>{u(!0);try{const a=await L.get(`/api/ventas/${s}/ticket`);v(a.data),x(!0)}catch(a){console.error(a),o({title:"Error al cargar ticket",description:"No se pudo obtener la información.",variant:"destructive"})}finally{u(!1)}},D=se.useReactToPrint({contentRef:m,documentTitle:l?`Ticket-${l.folio}`:"Ticket-Venta",onAfterPrint:()=>console.log("Impresión finalizada"),onPrintError:s=>console.error("Error al imprimir:",s)}),E=()=>{if(!m.current){console.error("El contenido del ticket no está disponible"),o({title:"Error",description:"El ticket no está listo para imprimir",variant:"destructive"});return}if(!l){console.error("No hay datos del ticket"),o({title:"Error",description:"No hay datos para imprimir",variant:"destructive"});return}D()},H=s=>{j(s),d(!0)},S=()=>{p&&P.delete(`/ventas/${p}`,{onSuccess:()=>{o({title:"Venta anulada y stock restaurado",className:"bg-green-600 text-white"}),d(!1),j(null)},onError:()=>o({title:"Error al anular",variant:"destructive"})})};return e.jsxs(Z,{children:[e.jsx(F,{title:"Historial de Ventas"}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx(O,{title:"Historial de Ventas",subtitle:"Consulta, reimprime o anula tickets anteriores"}),e.jsx("main",{className:"flex-1 p-6 bg-background",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 justify-between items-end",children:[e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{className:"bg-card p-4 rounded-lg border shadow-sm transition-all duration-200 hover:shadow-lg hover:-translate-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ventas Totales"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:["$ ",y.toFixed(2)]})]}),e.jsxs("div",{className:"bg-card p-4 rounded-lg border shadow-sm transition-all duration-200 hover:shadow-lg hover:-translate-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Utilidad Estimada"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:["$ ",A.toFixed(2)]})]})]}),e.jsxs(r,{variant:"outline",className:"gap-2",children:[e.jsx(ae,{className:"w-4 h-4"})," Filtros"]})]}),e.jsx("div",{className:"bg-card rounded-lg border border-border shadow-sm",children:e.jsxs(R,{children:[e.jsx($,{children:e.jsxs(h,{children:[e.jsx(i,{className:"w-[100px]",children:"Folio"}),e.jsx(i,{children:"Fecha"}),e.jsx(i,{children:"Cliente"}),e.jsx(i,{children:"Cajero"}),e.jsx(i,{children:"Método"}),e.jsx(i,{className:"text-right",children:"Total"}),e.jsx(i,{className:"text-center",children:"Opciones"})]})}),e.jsx(z,{children:c.length===0?e.jsx(h,{children:e.jsx(t,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No hay ventas registradas"})}):c.map(s=>e.jsxs(h,{children:[e.jsx(t,{className:"font-mono text-xs font-bold",children:s.folio}),e.jsx(t,{className:"text-xs",children:s.fecha}),e.jsx(t,{children:s.cliente}),e.jsx(t,{className:"text-muted-foreground text-xs",children:s.usuario}),e.jsx(t,{children:e.jsx(Y,{variant:"outline",className:"capitalize",children:s.metodo_pago})}),e.jsxs(t,{className:"text-right font-bold",children:["$"," ",Number(s.monto).toFixed(2)]}),e.jsx(t,{children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(r,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",title:"Imprimir ticket",onClick:()=>C(s.id),disabled:T,children:e.jsx(f,{className:"w-4 h-4 text-slate-600 dark:text-slate-400"})}),e.jsx(r,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",title:"Anular venta",onClick:()=>H(s.id),children:e.jsx(q,{className:"w-4 h-4 text-destructive"})})]})})]},s.id))})]})})]})}),e.jsx(M,{open:k,onOpenChange:x,children:e.jsxs(_,{className:"max-w-sm",children:[e.jsx(B,{children:e.jsx(U,{children:"Imprimir Ticket"})}),e.jsx("div",{className:"bg-muted p-4 rounded-md flex justify-center max-h-[60vh] overflow-y-auto",children:l?e.jsx(ee,{ref:m,data:l,businessSettings:N,printerSettings:b}):e.jsx(ie,{className:"w-8 h-8 animate-spin text-blue-600"})}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(r,{variant:"outline",onClick:()=>x(!1),children:"Cerrar"}),e.jsxs(r,{onClick:E,disabled:!l,children:[e.jsx(f,{className:"w-4 h-4 mr-2"})," Imprimir"]})]})]})}),e.jsx(G,{open:w,onOpenChange:d,children:e.jsxs(J,{children:[e.jsxs(K,{children:[e.jsx(Q,{children:"¿Anular venta?"}),e.jsxs(W,{className:"space-y-2",children:[e.jsx("p",{children:"¿Estás seguro de ANULAR esta venta?"}),e.jsxs("ul",{className:"list-disc list-inside text-sm text-muted-foreground",children:[e.jsx("li",{children:"Se devolverá el stock al inventario."}),e.jsx("li",{children:"La venta desaparecerá de los reportes."})]}),e.jsx("p",{className:"font-bold text-destructive mt-2",children:"Esta acción no se puede deshacer."})]})]}),e.jsxs(X,{children:[e.jsx(r,{variant:"ghost",onClick:()=>d(!1),children:"Cancelar"}),e.jsx(r,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:S,children:"Anular Venta"})]})]})})]})]})}export{Ne as default};
