import{c as F,r as i,j as e,H as O,L as B,g as H}from"./app-Bi53cwRe.js";import{H as $}from"./Header-uQBK6Lvz.js";import{C as b,a as u,b as p,c as f}from"./card-CuJFQQ2i.js";import{T as V,a as G,b as C,c,d as z,e as l}from"./table-Cy4khzhc.js";import{B as R}from"./badge-De33JYzz.js";import{B as g}from"./use-theme-CGehCXYH.js";import{S as D,a as T,b as _,c as A,d as y}from"./select-CoSvZzaJ.js";import{M as U,P as E,b as q,T as X}from"./MainLayout-jKifpoFS.js";import{D as Z,a as J,b as K,c as Q}from"./dialog-DHyflgsl.js";import{l as W}from"./index-3JJJLzBS.js";import{A as Y}from"./arrow-left-DZzMb7wR.js";import{D as ee}from"./dollar-sign-CsZ9eZSj.js";import{M as te}from"./minus-zEaVp_Tz.js";import{P as re}from"./plus-ju-uYPjB.js";/* empty css            */import"./user-DFNe86Sn.js";import"./index-DkYS_QLe.js";import"./index-PFpZpo28.js";import"./index-DlbaUiBa.js";import"./check-Dyfwx27W.js";const se=[["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}],["path",{d:"m17 13 5 5m-5 0 5-5",key:"im3w4b"}]],ae=F("package-x",se),le=i.forwardRef(function({data:o},j){if(!o)return null;const x=o.productos.reduce((s,n)=>{const m=Math.max(0,n.min_stock-n.stock);return s+m*n.purchase_price},0);return e.jsxs("div",{ref:j,className:"p-8 bg-white text-black max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-6 border-b-2 border-gray-800 pb-4",children:[e.jsx("h1",{className:"text-2xl font-bold uppercase",children:"Lista de Reabastecimiento"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:o.fecha}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Total de productos: ",o.productos.length]})]}),e.jsxs("table",{className:"w-full text-sm border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"border border-gray-300 p-2 text-center w-10",children:e.jsx("span",{className:"sr-only",children:"Check"})}),e.jsx("th",{className:"border border-gray-300 p-2 text-left",children:"Producto"}),e.jsx("th",{className:"border border-gray-300 p-2 text-left",children:"Categoría"}),e.jsx("th",{className:"border  border-gray-300 p-2 text-center",children:"Stock"}),e.jsx("th",{className:"border border-gray-300 p-2 text-center",children:"Mín."}),e.jsx("th",{className:"border border-gray-300 p-2 text-center",children:"Pedir"}),e.jsx("th",{className:"border border-gray-300 p-2 text-right",children:"Costo"}),e.jsx("th",{className:"border border-gray-300 p-2 text-right",children:"Total"})]})}),e.jsx("tbody",{children:o.productos.map((s,n)=>{const m=s.min_stock-s.stock;return e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 p-2 text-center",children:e.jsx("div",{className:"w-4 h-4 border border-gray-400 mx-auto"})}),e.jsxs("td",{className:"border border-gray-300 p-2",children:[e.jsx("div",{className:"font-bold text-sm",children:s.description}),e.jsx("div",{className:"text-xs text-gray-500 font-mono",children:s.barcode||"S/C"})]}),e.jsx("td",{className:"border border-gray-300 p-2 text-sm",children:s.category?.name||"General"}),e.jsx("td",{className:"border border-gray-300 p-2 text-center font-bold text-red-600",children:s.stock}),e.jsx("td",{className:"border border-gray-300 p-2 text-center text-gray-600",children:s.min_stock}),e.jsx("td",{className:"border border-gray-300 p-2 text-center font-bold text-lg",children:m}),e.jsxs("td",{className:"border border-gray-300 p-2 text-right text-sm",children:["$",Number(s.purchase_price).toFixed(2)]}),e.jsxs("td",{className:"border border-gray-300 p-2 text-right font-bold text-sm",children:["$",(m*s.purchase_price).toFixed(2)]})]},n)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-gray-100 font-bold",children:[e.jsx("td",{colSpan:7,className:"border border-gray-300 p-2 text-right",children:"TOTAL ESTIMADO DE INVERSIÓN:"}),e.jsxs("td",{className:"border border-gray-300 p-2 text-right",children:["$",x.toLocaleString("es-AR",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})})]}),e.jsx("div",{className:"mt-6 text-xs text-gray-500 text-center border-t pt-4",children:e.jsxs("p",{children:["Documento generado el"," ",new Date().toLocaleString("es-ES")]})})]})});function Se({productos:d=[]}){const[o,j]=i.useState(!1),[x,s]=i.useState("todas"),[n,m]=i.useState("deficit"),k=i.useRef(null),L=i.useMemo(()=>{const t=new Set(d.map(r=>r.category?.name||"General"));return Array.from(t).sort()},[d]),a=i.useMemo(()=>{let t=[...d];return x!=="todas"&&(t=t.filter(r=>(r.category?.name||"General")===x)),t.sort((r,h)=>{switch(n){case"deficit":return h.min_stock-h.stock-(r.min_stock-r.stock);case"nombre":return r.description.localeCompare(h.description);default:return 0}}),t},[d,x,n]),v=i.useMemo(()=>{let t=0,r=0,h=0;return a.forEach(N=>{const w=Math.max(0,N.min_stock-N.stock);w>0&&(t+=w*N.purchase_price,h+=w),N.stock<=0&&r++}),{totalInversion:t,totalAgotados:r,totalReponer:h}},[a]),I={fecha:new Date().toLocaleString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),productos:a},M=W.useReactToPrint({contentRef:k,documentTitle:`Lista-Reabastecimiento-${new Date().toLocaleDateString()}`}),P=()=>{k.current&&M()},S=(t,r)=>{H.post(`/productos/${t}/stock`,{quantity:r},{preserveScroll:!0})};return e.jsxs(U,{children:[e.jsx(O,{title:"Reabastecimiento"}),e.jsxs("div",{className:"flex-1 flex flex-col h-full bg-background",children:[e.jsx($,{title:"Reabastecimiento",subtitle:"Productos por comprar y presupuesto de reposición"}),e.jsx("main",{className:"flex-1 p-6 overflow-y-auto",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center print:hidden",children:[e.jsx(B,{href:"/reportes",children:e.jsxs(g,{variant:"outline",className:"gap-2",children:[e.jsx(Y,{className:"w-4 h-4"})," Volver"]})}),e.jsxs(g,{onClick:()=>j(!0),className:"gap-2",disabled:a.length===0,children:[e.jsx(E,{className:"w-4 h-4"})," Imprimir Lista"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(b,{className:"bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-900 transition-all duration-200 hover:shadow-lg hover:-translate-y-1",children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium text-blue-800 dark:text-blue-300",children:"Total a Reponer"}),e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/30 transition-transform duration-200 hover:scale-110",children:e.jsx(q,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"})})]}),e.jsxs(f,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-900 dark:text-blue-200",children:[v.totalReponer," ",e.jsx("span",{className:"text-sm font-normal text-blue-700 dark:text-blue-300",children:"unidades"})]}),e.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1",children:["En ",a.length," productos"]})]})]}),e.jsxs(b,{className:"bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-900 transition-all duration-200 hover:shadow-lg hover:-translate-y-1",children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium text-green-800 dark:text-green-300",children:"Inversión Estimada"}),e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900/30 transition-transform duration-200 hover:scale-110",children:e.jsx(ee,{className:"h-4 w-4 text-green-600 dark:text-green-400"})})]}),e.jsxs(f,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-900 dark:text-green-200",children:["$",v.totalInversion.toLocaleString("es-AR",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:"Costo base de reposición"})]})]}),e.jsxs(b,{className:"bg-red-50 dark:bg-red-950/20 border-red-200 dark:border-red-900 transition-all duration-200 hover:shadow-lg hover:-translate-y-1",children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium text-red-800 dark:text-red-300",children:"Productos Agotados"}),e.jsx("div",{className:"p-2 rounded-lg bg-red-100 dark:bg-red-900/30 transition-transform duration-200 hover:scale-110",children:e.jsx(ae,{className:"h-4 w-4 text-red-600 dark:text-red-400"})})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-900 dark:text-red-200",children:v.totalAgotados}),e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:"Requieren atención inmediata"})]})]})]}),d.length>0&&e.jsxs(b,{children:[e.jsx(u,{children:e.jsx(p,{className:"text-base",children:"Filtros"})}),e.jsx(f,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Categoría"}),e.jsxs(D,{value:x,onValueChange:s,children:[e.jsx(T,{children:e.jsx(_,{placeholder:"Todas las categorías"})}),e.jsxs(A,{children:[e.jsx(y,{value:"todas",children:"Todas las categorías"}),L.map(t=>e.jsx(y,{value:t,children:t},t))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Ordenar por"}),e.jsxs(D,{value:n,onValueChange:m,children:[e.jsx(T,{children:e.jsx(_,{placeholder:"Ordenar por"})}),e.jsxs(A,{children:[e.jsx(y,{value:"deficit",children:"Mayor Déficit"}),e.jsx(y,{value:"nombre",children:"Nombre (A-Z)"})]})]})]})]})})]}),e.jsxs(b,{className:"border border-border shadow-md bg-card",children:[e.jsx(u,{className:"bg-orange-50 dark:bg-orange-950/30 border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-orange-800 dark:text-orange-400",children:[e.jsx(X,{className:"w-5 h-5"}),e.jsxs(p,{children:["Inventario Crítico (",a.length,")"]})]}),a.length>0&&e.jsxs(R,{variant:"outline",className:"bg-card border-orange-300 dark:border-orange-700 text-orange-700 dark:text-orange-400",children:[a.length," producto",a.length!==1?"s":""]})]})}),e.jsx(f,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(V,{children:[e.jsx(G,{children:e.jsxs(C,{children:[e.jsx(c,{children:"Código"}),e.jsx(c,{children:"Producto"}),e.jsx(c,{children:"Categoría"}),e.jsx(c,{className:"text-center",children:"Stock Actual"}),e.jsx(c,{className:"text-center",children:"Stock Mínimo"}),e.jsx(c,{className:"text-right",children:"Costo Unit."}),e.jsx(c,{className:"text-right",children:"Déficit"}),e.jsx(c,{className:"text-right",children:"Inversión"}),e.jsx(c,{className:"text-center",children:"Opciones"})]})}),e.jsx(z,{children:a.length===0?e.jsx(C,{children:e.jsx(l,{colSpan:9,className:"text-center py-8 text-green-600 font-medium",children:"¡Excelente! No hay productos con bajo stock."})}):a.map(t=>{const r=t.min_stock-t.stock;return e.jsxs(C,{className:"hover:bg-orange-50/30",children:[e.jsx(l,{className:"font-mono text-xs",children:t.barcode||"S/C"}),e.jsx(l,{className:"font-medium",children:t.description}),e.jsx(l,{className:"text-muted-foreground",children:t.category?.name||"General"}),e.jsx(l,{className:"text-center",children:e.jsx(R,{variant:"destructive",className:"text-sm font-bold",children:t.stock})}),e.jsx(l,{className:"text-center text-muted-foreground",children:t.min_stock}),e.jsxs(l,{className:"text-right text-muted-foreground",children:["$",Number(t.purchase_price).toFixed(2)]}),e.jsx(l,{className:"text-right font-bold text-orange-600",children:r}),e.jsxs(l,{className:"text-right font-bold text-green-700",children:["$",(r*t.purchase_price).toFixed(2)]}),e.jsx(l,{className:"text-center",children:e.jsxs("div",{className:"flex gap-1 justify-center",children:[e.jsx(g,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",title:"Disminuir stock del producto",onClick:()=>S(t.id,-1),children:e.jsx(te,{className:"w-4 h-4 text-orange-600"})}),e.jsx(g,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",title:"Agregar stock al producto",onClick:()=>S(t.id,1),children:e.jsx(re,{className:"w-4 h-4 text-green-600"})})]})})]},t.id)})})]})})})]})]})})]}),e.jsx(Z,{open:o,onOpenChange:j,children:e.jsxs(J,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(K,{children:e.jsx(Q,{children:"Lista de Reabastecimiento - Vista Previa"})}),e.jsx("div",{className:"bg-muted p-4 rounded-md flex justify-center",children:e.jsx(le,{ref:k,data:I})}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(g,{variant:"outline",onClick:()=>j(!1),children:"Cerrar"}),e.jsxs(g,{onClick:P,children:[e.jsx(E,{className:"w-4 h-4 mr-2"})," Imprimir"]})]})]})})]})}export{Se as default};
