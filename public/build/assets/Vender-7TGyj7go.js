import{c as de,i as me,f as xe,r,j as e,H as ue,X as S,h as he,g as fe}from"./app-Bi53cwRe.js";import{T as pe}from"./Ticket-B8XTleSG.js";import{l as be}from"./index-3JJJLzBS.js";import{u as ge}from"./useScannerWebSocket-C3sWXF0A.js";import{S as je}from"./switch-CGf-p9DI.js";import{L as ve}from"./label-COTh75sX.js";import{I as Ne}from"./input-P5n5ME8U.js";import{B as I}from"./use-theme-CGehCXYH.js";import{M as we,P as Ce,b as K}from"./MainLayout-jKifpoFS.js";import{H as ye}from"./Header-uQBK6Lvz.js";import{A as ke,a as Se,b as Pe,c as Ee,d as Ae,e as De,g as Te,h as Fe,T as _e}from"./alert-dialog-BmfwfED2.js";import{S as W}from"./search-BsQ32vNM.js";import{C as Ie}from"./credit-card-DwvTrN0f.js";import{D as Me}from"./dollar-sign-CsZ9eZSj.js";import{U as $e}from"./user-DFNe86Sn.js";import{U as ze}from"./user-plus-BMovOOA5.js";import{P as X}from"./plus-ju-uYPjB.js";import{M as Le}from"./minus-zEaVp_Tz.js";/* empty css            */import"./index-DlbaUiBa.js";import"./index-PFpZpo28.js";const Re=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]],qe=de("banknote",Re);function Be({product:l,onAdd:c}){return e.jsxs("button",{onClick:()=>c(l),className:"group relative flex flex-col items-center p-3 sm:p-4 bg-card border-2 border-border rounded-xl hover:border-ring hover:shadow-lg transition-all duration-200",children:[e.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 mb-2 sm:mb-3 bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30 rounded-full flex items-center justify-center text-lg sm:text-xl font-bold text-blue-600 dark:text-blue-400 shadow-sm",children:l.description.charAt(0).toUpperCase()}),e.jsx("p",{className:"text-xs sm:text-sm font-semibold text-foreground text-center line-clamp-2 mb-1 leading-tight",children:l.description}),e.jsxs("p",{className:"text-base sm:text-lg font-bold text-blue-600 dark:text-blue-400",children:["$",Number(l.sale_price).toFixed(2)]}),e.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("div",{className:"bg-blue-600 rounded-full p-1 shadow-md",children:e.jsx(X,{className:"w-3 h-3 sm:w-4 sm:h-4 text-white"})})})]})}function Oe({item:l,onIncrease:c,onDecrease:h,onRemove:d}){return e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 p-2 sm:p-3 bg-muted/80 rounded-lg border border-border hover:bg-card hover:shadow-sm transition-all",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-foreground truncate text-xs sm:text-sm",children:l.description}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["$",Number(l.sale_price).toFixed(2)," c/u"]})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx(I,{variant:"outline",size:"sm",className:"h-7 w-7 p-0 transition-all duration-200",title:"disminuir cantidad",onClick:()=>h(l.id),children:e.jsx(Le,{className:"w-3 h-3 text-red-600"})}),e.jsx("span",{className:"w-6 sm:w-8 text-center font-bold text-xs sm:text-sm tabular-nums",children:l.quantity}),e.jsx(I,{variant:"outline",size:"sm",className:"h-7 w-7 p-0 transition-all duration-200",title:"aumentar cantidad",onClick:()=>c(l.id),children:e.jsx(X,{className:"w-3 h-3 text-green-600"})})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1 min-w-[60px]",children:[e.jsxs("p",{className:"font-bold text-xs sm:text-sm text-foreground",children:["$",l.total.toFixed(2)]}),e.jsx(I,{variant:"outline",size:"sm",className:"h-7 w-7 p-0 transition-all duration-200",title:"Eliminar del carrito",onClick:()=>d(l.id),children:e.jsx(_e,{className:"w-3 h-3 sm:w-4 sm:h-4 text-destructive"})})]})]})}function M({icon:l,label:c,isSelected:h,onClick:d}){return e.jsxs("button",{onClick:d,className:`flex flex-col items-center gap-2 p-2 sm:p-3 rounded-lg border transition-all duration-200 ${h?"border-blue-500 bg-blue-500/10 text-blue-600 dark:text-blue-400":"border-border text-muted-foreground hover:bg-muted hover:scale-105"}`,children:[e.jsx(l,{className:`w-5 h-5 sm:w-6 sm:h-6 ${h?"text-blue-600 dark:text-blue-400":"text-muted-foreground"}`}),e.jsx("span",{className:"text-xs font-semibold",children:c})]})}function xt({allProducts:l,clients:c}){const{props:h}=me(),{flash:d,businessSettings:G,printerSettings:Y}=h,{toast:m}=xe(),[f,$]=r.useState(null),z=r.useRef(null),[p,Z]=r.useState(()=>{const t=localStorage.getItem("autoPrint");return t?JSON.parse(t):!0});r.useEffect(()=>{localStorage.setItem("autoPrint",JSON.stringify(p))},[p]);const ee=be.useReactToPrint({contentRef:z,documentTitle:f?`Ticket-${f.folio}`:"Ticket-Venta",onAfterPrint:()=>$(null),onPrintError:t=>console.error("Error al imprimir:",t)});r.useEffect(()=>{d?.sale_id&&p&&(async()=>{try{const s=await he.get(`/api/ventas/${d.sale_id}/ticket`);$(s.data)}catch(s){console.error("Error fetching ticket:",s),m({title:"Error",description:"No se pudo cargar el ticket para impresión",variant:"destructive"})}})()},[d?.sale_id,p]),r.useEffect(()=>{f&&ee()},[f]);const[b,L]=r.useState(""),[n,g]=r.useState([]),[j,v]=r.useState(!1),[N,w]=r.useState("efectivo"),[R,x]=r.useState(""),P=r.useRef(null),[te,C]=r.useState(!1),[i,y]=r.useState(null),[se,E]=r.useState(!1),[re,A]=r.useState(!1),[D,q]=r.useState(""),[B,O]=r.useState(""),[k,T]=r.useState(""),V=l.filter(t=>t.description.toLowerCase().includes(b.toLowerCase())||t.barcode&&t.barcode.includes(b)).sort((t,s)=>{const a=o=>o.barcode===b?1:o.barcode&&o.barcode.startsWith(b)?2:o.description.toLowerCase().includes(b.toLowerCase())?3:4;return a(t)-a(s)}),U=k.trim()===""?[]:c.filter(t=>t.name.toLowerCase().includes(k.toLowerCase())),u=n.reduce((t,s)=>t+s.total,0),F=parseFloat(R)||0,_=F-u;r.useEffect(()=>{P.current?.focus()},[]),r.useEffect(()=>{j&&x("")},[j]),r.useEffect(()=>{const t=s=>{s.key==="F9"&&n.length>0&&!j&&(s.preventDefault(),v(!0))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[n.length,j]);const H=t=>{const s=n.find(o=>o.id===t.id),a=Number(t.sale_price);g(s?n.map(o=>o.id===t.id?{...o,quantity:o.quantity+1,total:(o.quantity+1)*a}:o):[...n,{...t,quantity:1,total:a,sale_price:a}]),L(""),P.current?.focus(),C(!1)};ge(t=>{const s=l.find(a=>a.barcode===t);s?(H(s),m({title:"Producto agregado",description:s.description,duration:2e3})):m({title:"Producto no encontrado",description:`Código: ${t}`,variant:"destructive",duration:2e3})});const Q=(t,s)=>{g(n.map(a=>{if(a.id===t){const o=Math.max(1,a.quantity+s);return{...a,quantity:o,total:o*Number(a.sale_price)}}return a}))},ae=t=>{g(n.filter(s=>s.id!==t))},le=()=>{A(!0)},oe=()=>{g([]),v(!1),x(""),A(!1)},ne=t=>{y(t),T("")},ie=()=>{y(null)},ce=()=>{if(!D.trim())return;y({name:D,phone:B}),E(!1),q(""),O("")},J=()=>{if(n.length===0){m({title:"Error",description:"El carrito está vacío",variant:"destructive"});return}if(F<u){m({title:"Error",description:"Monto insuficiente",variant:"destructive"});return}const t={items:n.map(s=>({id:s.id,quantity:s.quantity,salePrice:Number(s.sale_price)})),payment_method:N,amount_received:F,client_id:i?.id||null,client_name:i?.id?null:i?.name,client_phone:i?.id?null:i?.phone};fe.post("/vender",t,{onSuccess:()=>{m({title:"¡Venta Exitosa!",description:N==="efectivo"?`Cambio: $${_.toFixed(2)}`:"Venta procesada correctamente",className:"bg-green-500 text-white"}),g([]),v(!1),x(""),y(null),T(""),w("efectivo"),C(!1)},onError:s=>{console.error("Error en venta:",s);let a="No se pudo procesar la venta. Verifique los datos.";s.error?a=s.error:typeof s=="string"?a=s:s.message&&(a=s.message),m({title:"Error",description:a,variant:"destructive"})}})};return e.jsxs(we,{children:[e.jsx(ue,{title:"Vender"}),e.jsx(ke,{open:re,onOpenChange:A,children:e.jsxs(Se,{children:[e.jsxs(Pe,{children:[e.jsx(Ee,{children:"¿Estás seguro?"}),e.jsx(Ae,{children:"Esta acción vaciará todo el carrito de compras. No podrás deshacer esta acción."})]}),e.jsxs(De,{children:[e.jsx(Te,{children:"Cancelar"}),e.jsx(Fe,{onClick:oe,className:"bg-red-600 hover:bg-red-700",children:"Sí, vaciar carrito"})]})]})}),e.jsx("div",{className:"hidden",children:f&&e.jsx(pe,{ref:z,data:f,businessSettings:G,printerSettings:Y})}),e.jsxs("div",{className:"absolute inset-0 flex flex-col bg-background overflow-hidden",children:[e.jsx(ye,{title:"Nueva Venta",subtitle:"Agrega productos al carrito y procesa el pago"}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"flex-1 flex flex-col bg-background p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto w-full flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"bg-card border border-border rounded-lg p-3 sm:p-4 shadow-sm mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ce,{className:"w-4 h-4 sm:w-5 sm:h-5 text-primary"}),e.jsx("h3",{className:"font-semibold text-foreground text-sm sm:text-base",children:"Impresión Automática"})]}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground hidden sm:block",children:"Imprime el ticket automáticamente al finalizar la venta"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ve,{htmlFor:"auto-print-switch",className:"text-xs sm:text-sm font-medium",children:p?"Activo":"Inactivo"}),e.jsx(je,{id:"auto-print-switch",checked:p,onCheckedChange:Z})]})]})}),e.jsx("div",{className:"mb-6 flex items-center gap-4",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-muted-foreground"}),e.jsx(Ne,{ref:P,type:"text",placeholder:"Buscar un producto por su descripción o código de barras",value:b,onChange:t=>L(t.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border flex flex-col flex-1 min-h-0",children:e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:V.length===0?e.jsx("p",{className:"text-center text-muted-foreground mt-10",children:"No se encontraron productos"}):e.jsx("div",{className:"grid gap-3 sm:gap-4",style:{gridTemplateColumns:"repeat(auto-fill, minmax(150px, 1fr))"},children:V.slice(0,20).map(t=>e.jsx(Be,{product:t,onAdd:H},t.id))})})})]})}),e.jsxs("div",{className:`${te?"fixed inset-0 z-50 bg-card":"hidden"} lg:flex lg:relative lg:w-[380px] xl:w-[420px] bg-card flex-col shadow-xl z-20 rounded-t-xl overflow-hidden`,children:[e.jsx("div",{className:"p-3 sm:p-4 bg-blue-600 text-white shadow-md flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),e.jsx("h2",{className:"font-bold text-base sm:text-lg",children:"Carrito"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"bg-white/20 px-3 py-0.5 rounded-full text-sm font-medium",children:n.length}),e.jsx("button",{onClick:()=>C(!1),className:"lg:hidden p-1",children:e.jsx(S,{className:"w-5 h-5"})})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 sm:p-4 space-y-2 sm:space-y-3 bg-muted/30 min-h-0",children:n.length===0?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(K,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Carrito vacío"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Agrega productos desde el panel izquierdo"})]})}):n.map(t=>e.jsx(Oe,{item:t,onIncrease:()=>Q(t.id,1),onDecrease:()=>Q(t.id,-1),onRemove:ae},t.id))}),n.length>0&&e.jsxs("div",{className:"bg-card p-3 sm:p-4 border-t border-border flex-shrink-0 shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-3 sm:mb-4",children:[e.jsx("span",{className:"text-lg sm:text-xl font-bold text-foreground",children:"Total"}),e.jsxs("span",{className:"text-2xl sm:text-3xl font-extrabold text-blue-600",children:["$",u.toFixed(2)]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-3",children:[e.jsx("button",{onClick:le,className:"px-3 sm:px-4 py-2.5 sm:py-3 border border-red-100 text-red-600 rounded-xl font-semibold hover:bg-red-50 text-sm sm:text-base transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:()=>{v(!0),C(!1)},className:"px-3 sm:px-4 py-2.5 sm:py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 text-sm sm:text-base transition-colors",children:"Cobrar (F9)"})]})]})]})]}),j&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-card rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto p-4 sm:p-6 space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-3 sm:pb-4 sticky top-0 bg-card z-10",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold",children:"Procesar Pago"}),e.jsx("button",{onClick:()=>v(!1),className:"p-1 hover:bg-gray-100 rounded-full",children:e.jsx(S,{className:"w-5 h-5"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-muted-foreground uppercase mb-2 sm:mb-3",children:"Método de Pago"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-3",children:[e.jsx(M,{icon:qe,label:"Efectivo",isSelected:N==="efectivo",onClick:()=>{w("efectivo"),x(u.toFixed(2))}}),e.jsx(M,{icon:Ie,label:"Tarjeta",isSelected:N==="tarjeta",onClick:()=>{w("tarjeta"),x(u.toFixed(2))}}),e.jsx(M,{icon:Me,label:"Transfer",isSelected:N==="transferencia",onClick:()=>{w("transferencia"),x(u.toFixed(2))}})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-muted-foreground uppercase mb-2",children:"Cliente (Opcional)"}),se?e.jsxs("div",{className:"space-y-2 border p-3 rounded bg-muted animate-in fade-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-semibold text-blue-600 dark:text-blue-400",children:"Nuevo Cliente"}),e.jsx("button",{onClick:()=>E(!1),className:"text-muted-foreground hover:text-red-500",children:e.jsx(S,{className:"w-4 h-4"})})]}),e.jsx("input",{className:"w-full border border-input bg-background text-foreground p-2 rounded text-sm",placeholder:"Nombre completo *",value:D,onChange:t=>q(t.target.value),autoFocus:!0}),e.jsx("input",{className:"w-full border border-input bg-background text-foreground p-2 rounded text-sm",placeholder:"Teléfono (opcional)",value:B,onChange:t=>O(t.target.value)}),e.jsx("button",{onClick:ce,className:"w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700 text-sm font-medium transition-colors",children:"Usar este cliente"})]}):e.jsx("div",{className:"relative",children:i?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-900 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900/40 p-1.5 rounded-full",children:e.jsx($e,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm text-foreground",children:i.name}),i.phone&&e.jsx("p",{className:"text-xs text-muted-foreground",children:i.phone})]})]}),e.jsx("button",{onClick:ie,className:"text-muted-foreground hover:text-red-500 p-1",children:e.jsx(S,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx("input",{className:"w-full pl-9 pr-4 py-2 border border-input bg-background text-foreground rounded-lg focus:ring-2 focus:ring-ring focus:border-ring outline-none transition-all text-sm",placeholder:"Buscar cliente...",value:k,onChange:t=>T(t.target.value)}),k&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-card border rounded-lg shadow-lg max-h-40 overflow-y-auto",children:U.length>0?U.map(t=>e.jsxs("div",{onClick:()=>ne(t),className:"p-2 hover:bg-accent cursor-pointer text-sm border-b last:border-0 flex justify-between items-center",children:[e.jsx("span",{children:t.name}),t.phone&&e.jsx("span",{className:"text-xs text-muted-foreground",children:t.phone})]},t.id)):e.jsx("div",{className:"p-3 text-sm text-muted-foreground text-center",children:"No encontrado"})})]}),e.jsx("button",{onClick:()=>E(!0),className:"p-2 bg-muted rounded-lg hover:bg-accent text-muted-foreground border border-border transition-colors",title:"Crear nuevo cliente",children:e.jsx(ze,{className:"w-5 h-5"})})]})})]}),e.jsxs("div",{className:"bg-card border border-border p-3 sm:p-4 rounded-xl space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-lg sm:text-xl font-bold",children:[e.jsx("span",{className:"text-foreground",children:"Total:"}),e.jsxs("span",{className:"text-blue-600 dark:text-blue-400",children:["$",u.toFixed(2)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3",children:[e.jsx("label",{className:"font-semibold text-sm sm:text-base text-foreground whitespace-nowrap",children:"Monto a Pagar:"}),e.jsx("input",{type:"number",step:"0.01",autoFocus:!0,className:"flex-1 w-full border border-input bg-background text-foreground rounded p-2 font-bold text-base sm:text-lg text-right",value:R,onChange:t=>x(t.target.value),onKeyDown:t=>t.key==="Enter"&&J(),placeholder:"0.00"})]}),e.jsxs("div",{className:"flex justify-between text-base sm:text-lg",children:[e.jsx("span",{className:"text-foreground",children:"Cambio:"}),e.jsxs("span",{className:`font-bold ${_<0?"text-red-500 dark:text-red-400":"text-green-600 dark:text-green-400"}`,children:["$",_.toFixed(2)]})]})]})]}),e.jsx("button",{onClick:J,className:"w-full py-3 sm:py-4 bg-green-600 text-white rounded-xl font-bold text-base sm:text-lg hover:bg-green-700 transition-colors shadow-lg",children:"Confirmar Venta"})]})})]})]})}export{xt as default};
